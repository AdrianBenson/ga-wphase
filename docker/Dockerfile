FROM centos:centos7
ARG LOCAL_INSTALL_FOLDER=/tmp
ARG BASEMAP_ARCHIVE_NAME
ARG WPHASE_GREENS_FUNCTIONS_DIR
ARG WPHASE_GREENS_FUNCTIONS_FILE
ARG ARG_WPHASE_WEB_OUTPUTS_ROOT
ARG ARG_WPHASE_SAVED_DATASETS_ROOT
ARG ARG_WPHASE_TEST_DATASETS_ROOT
ARG ARG_WPHASE_GREENS_FUNCTIONS
ENV WPHASE_WEB_OUTPUTS_ROOT="$ARG_WPHASE_WEB_OUTPUTS_ROOT"
ENV WPHASE_SAVED_DATASETS_ROOT="$ARG_WPHASE_SAVED_DATASETS_ROOT"
ENV WPHASE_TEST_DATASETS_ROOT="$ARG_WPHASE_TEST_DATASETS_ROOT"
ENV WPHASE_GREENS_FUNCTIONS="$ARG_WPHASE_GREENS_FUNCTIONS"

COPY $BASEMAP_ARCHIVE_NAME "$LOCAL_INSTALL_FOLDER"/"$BASEMAP_ARCHIVE_NAME"
COPY requirements.txt /requirements.txt

# The installation scripts are separated into two layers because
# install_depedencies is very slow and doesn't change very often.
COPY install_dependencies.sh "$LOCAL_INSTALL_FOLDER"/install_dependencies.sh
RUN "$LOCAL_INSTALL_FOLDER"/install_dependencies.sh

COPY configure_wphase_image.sh "$LOCAL_INSTALL_FOLDER"/configure_wphase_image.sh
RUN "$LOCAL_INSTALL_FOLDER"/configure_wphase_image.sh
